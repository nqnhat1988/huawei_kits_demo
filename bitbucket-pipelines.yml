image: circleci/android:api-28

options:
  size: 2x

pipelines:
  default:
    - step:
        caches:
          - gradle
        script:
          - bash ./license.sh
          - ./gradlew assemble --stacktrace
  tags:
    gms-*:
      - step:
          caches:
            - gradle
          script:
            - bash ./license.sh
            - ./gradlew assembleGms --stacktrace
    hms-*:
      - step:
          caches:
            - gradle
          script:
            - bash ./license.sh
            - ./gradlew assembleHms --stacktrace
    branches:
      production/gms:
        - step:
            caches:
              - gradle
            script:
              - bash ./license.sh
              - ./gradlew assembleGmsRelease --stacktrace
      production/hms:
        - step:
            caches:
              - gradle
            script:
              - bash ./license.sh
              - ./gradlew assembleHmsRelease --stacktrace